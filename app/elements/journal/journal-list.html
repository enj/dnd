<link rel="import" href="journal-entry.html">

<dom-module id="journal-list">
    <style>

        .item {
            display: flex;
            /*flex: flex-grow;*/
            flex-grow: 3;
            flex-basis: auto;
        }

        .journals {
            overflow: auto;
            min-width: 300px;
            max-width: 600px;
            height: 400px;
            /*width: 40%;*/
            /*height: 400px;*/
        }

        paper-icon-button[toggles][active] {
            color: #F00;
        }

        ul {
            list-style: none;
            padding-left: 15px;
            padding-right: 15px;
        }

        li + li {
            border-top: solid 1px #666;
        }

        .new-journal {
            padding: 0px 15px 15px 15px;
        }

        paper-toolbar {
            background-color: #800;
            height: 40px;

          --paper-toolbar: {
            @apply(--layout-vertical);
          };
        }

    </style>

    <template>
        <iron-signals
            on-iron-signal-fbupdate="_updateJournals">
        </iron-signals>

        <div style="padding:20px">
            <paper-material elevation=5 class="journals">
                <paper-header-panel>
                    <paper-toolbar>
                        <table width=100%>
                            <tr>
                                <td><div class="paper-header">Journal</div></td>
                                <td align="right"><paper-icon-button icon="settings" toggles on-tap="_handleEdit"></paper-icon-button></td>
                            </tr>
                        </table>
                    </paper-toolbar>
                    <ul>
                        <template id="jList" is="dom-repeat" items="{{journals}}" as="item">
                            <li>
                                <journal-entry
                                    name="{{item.name}}"
                                    text="{{item.text}}"
                                    key="{{item.__firebaseKey__}}">
                                </journal-entry>
                            </li>
                        </template>
                    </ul>
                    <div class="new-journal">
                        <form is="iron-form" id="jform">
                            <paper-input id="name_field" name="name" label="New Title" required></paper-input>
                            <paper-textarea id="text_field" name="text" label="New Journal Entry" required></paper-textarea>
                            <paper-button id="sub_but" raised on-tap="_handleSubmit">Save</paper-button>
                            <div class="output"></div>
                        </form>
                    </div>
                </paper-header-panel>
            </paper-material>
        </div>
    </template>

</dom-module>



<script>
    Polymer({
        is: "journal-list",

        _redraw: function() {
            this.$.jList.render();
        },

        properties: {
            scroll: "true",
            journals: {
                type: Array,
                notify: true
            }
        },

        _updateJournals: function(e) {
            this.journals = app.$.journal.fbData;
            this._redraw();
        },

        _handleSubmit: function(e) {
            if(!this.$.jform.validate()) return;
            var entry = this.$.jform.serialize();
            var appjournal = app.$.journal.$.ref;
            appjournal.add(entry);

            this.$.text_field.value = "";
            this.$.name_field.value = "";
        },

        _handleEdit: function(e) {
            this.fire('iron-signal', {name: 'editjournal', data: this.namespace});
        }

    });
</script>
