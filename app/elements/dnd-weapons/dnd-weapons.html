<link rel="import" href="dnd-weapon.html">

<dom-module id="dnd-weapons">

	<style>

		ul {
            list-style: none;
            padding-left: 15px;
            padding-right: 15px;
        }

        li + li {
            border-top: solid 1px #666;
        }

        .add-weapon {
            padding: 0px 15px 15px 15px;
        }

        paper-toolbar {
            background-color: #800;
            height: 40px;

          --paper-toolbar: {
            @apply(--layout-vertical);
          };
        }

        paper-icon-button[toggles][active] {
            color: #F00;
        }

        paper-dialog div {
            padding:0px;
            margin:0px;
        }

	</style>

	<template>
		<iron-signals
            on-iron-signal-fbupdate="_updateWeapons">
        </iron-signals>

            <paper-header-panel>
                    <paper-toolbar>
                        <table width=100%>
                            <tr>
                                <td><div class="paper-header">Weapons</div></td>
                                <td align="right">
                                <paper-icon-button id="toggle" icon="remove-circle-outline" toggles on-tap="_handleEdit">
                                </paper-icon-button></td>
                            </tr>
                        </table>
                    </paper-toolbar>
	        	<ul>
	        		<table width=100% style="color: #888;"><tr>
	                    <td>Weapon</td>
	                    <td width=60 align=center>Weight</td>
                        <td width=60 align=center>Power</td>
	                    <td width=35 align=right></td>
	                </table>
	                <template id="weaponsList" is="dom-repeat" items="{{weapons}}" as="weapon">
	                    <li>
	                        <dnd-weapon
	                            name="{{weapon.name}}"
	                            weight="{{weapon.weight}}"
	                            power="{{weapon.power}}"
	                            key="{{weapon.__firebaseKey__}}">
	                        </dnd-weapon>
	                    </li>
	                </template>
	        	</ul>

                <paper-icon-button icon="add-circle-outline" style="color:green;" title="test" on-click="toggle"></paper-icon-button>

	            <paper-dialog id="addWeaponDialog" withBackdrop="true" modal>
    	            <div class="add-weapon">
                        <paper-toolbar><div class="paper-header">Add Weapon</div></paper-toolbar>
                        <div style="padding:10px">
    	                <form is="iron-form" id="aform">
    	                    <paper-input id="name_field" name="name" label="Name" required></paper-input>
    	                    <!--<paper-input id="power_field" type="number" name="power" label="Power" value=0></paper-input>-->
                            <paper-dropdown-menu label="Power of Your weapon" selected-item-label="{{selected}}">
                                <paper-listbox id="power_field" class="dropdown-content">
                                    <paper-item value="None">None</paper-item>
                                    <paper-item value="1d3">1d3</paper-item>
                                    <paper-item value="1d4">1d4</paper-item>
                                    <paper-item value="1d6">1d6</paper-item>
                                    <paper-item value="1d8">1d8</paper-item>
                                    <paper-item value="1d10">1d10</paper-item>
                                    <paper-item value="1d12">1d12</paper-item>
                                </paper-listbox>
                            </paper-dropdown-menu>
                            <input is="iron-input" name="power" type="hidden" value$="[[selected]]">
    	                    <paper-input id="weight_field" type="number" name="weight" label="Weight"></paper-input>
    	                    <paper-button id="add_but" raised on-tap="_handleSubmit">Save</paper-button>
                            <paper-button style="color: red !important;" raised on-tap="toggle">Cancel</paper-button>
    	                    <div class="output"></div>
    	                </form>
                    	</div>
    	            </div>
	            </paper-dialog>

            </paper-header-panel>

	</template>

</dom-module>

<script>

	Polymer({
        is: "dnd-weapons",

        _redraw: function() {
            this.$.weaponsList.render();
        },

        properties: {
            scroll: "true",
            weapons: {
                type: Array,
                notify: true
            }
        },

        _updateWeapons: function(e) {
            this.weapons = app.$.weapons.fbData;
            if(this.weapons.length == 0) {
                this.$.toggle.active = false;
            }
            this._redraw();
        },

        _handleSubmit: function(e) {
            this.$.addWeaponDialog.toggle();
            if(this.$.toggle.active) {
                this.$.toggle.active = false;
                this._handleEdit(e);
            }
            var entry = this.$.aform.serialize();
            if(!this.$.aform.validate()) return;
            var appweapons = app.$.weapons.$.ref;
            appweapons.add(entry);

            this.$.name_field.value = "";
            this.$.weight_field.value = "";
            this.$.power_field.selected = "";
        },

        toggle: function() {
            this.$.addWeaponDialog.toggle();
            this.$.power_field.selected = "";
        },

        _handleEdit: function(e) {
            if(this.weapons.length == 0) {
                this.$.toggle.active = false;
                return;
            }
            this.fire('iron-signal', {name: 'editweapons', data: this.namespace});
        }

    });

</script>