<dom-module id="dnd-hp">
    <style>
        .hpi {
            float: left;
            width: 90px;
            padding: 5px 5px 5px 5px;
        }

        paper-toolbar {
            background-color: #800;
            height: 40px;

          --paper-toolbar: {
            @apply(--layout-vertical);
          };
        }

    </style>

    <template>
        <hp-validator id="chpValid" validator-name="chpValidator"></hp-validator>
        <hp-validator id="mhpValid" validator-name="mhpValidator"></hp-validator>
        <iron-signals
            on-iron-signal-fbupdate="_updateHP">
        </iron-signals>
        <paper-header-panel>
                <paper-toolbar>
                    <div class="paper-header">Hit Points</div>
                </paper-toolbar>
            <paper-input id="currentHP"
                   class="hpi"
                   value="{{currentHP}}"
                   label="Current HP"
                   on-keyup="setCurrentHP"
                   auto-validate
                   validator="chpValidator"
                   error-message="int [-300,300]">
            </paper-input>
            <paper-input id="maxHP"
                   class="hpi"
                   value="{{maxHP}}"
                   label="Max HP"
                   on-keyup="setMaxHP"
                   auto-validate
                   validator="mhpValidator"
                   error-message="int [1,300]">
            </paper-input>
        </paper-header-panel>
    </template>
</dom-module>

<script>
    Polymer({
        is: "dnd-hp",

        properties: {
            currentHP: {
                type: Number,
                notify: true
            },
            maxHP: {
                type: Number,
                notify: true
            }
        },

        _updateHP: function(e) {
            app.$.hp.update(e, this);
        },

        setMaxHP: function(e) {
            if (this.mhpValidator(this.maxHP)) {
                app.hpData = {maxHP: ~~this.maxHP};
            }
        },

        setCurrentHP: function(e) {
            if (this.chpValidator(this.currentHP)) {
                app.hpData = {currentHP: ~~this.currentHP};
            }
        },

        ready: function() {
            this.$.chpValid.validate = this.chpValidator.bind(this);
            this.$.mhpValid.validate = this.mhpValidator.bind(this);
        },

        mhpValidator: function(v) {
            var hp = ~~v;
            if (v && !isNaN(v) && +v === hp && hp >= 1 && hp <= 300) {
                return true;
            }
            return false;
        },

        chpValidator: function(v) {
            var hp = ~~v;
            if (v && !isNaN(v) && +v === hp && hp >= -300 && hp <= 300) {
                return true;
            }
            return false;
        },
    });

    Polymer({
        is: "hp-validator",

        behaviors: [
            Polymer.IronValidatorBehavior
        ],
    });
</script>
